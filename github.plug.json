{
  "name": "github",
  "imports": [
    "https://get.silverbullet.md/global.plug.json"
  ],
  "functions": {
    "queryEvents": {
      "events": [
        "query:gh-event"
      ],
      "code": "(() => { var mod=(()=>{var S=Object.create;var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var w=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,t)=>(typeof require!=\"undefined\"?require:r)[t]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var y=(e,r)=>{for(var t in r)m(e,t,{get:r[t],enumerable:!0})},v=(e,r,t,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let n of L(r))!I.call(e,n)&&n!==t&&m(e,n,{get:()=>r[n],enumerable:!(o=F(r,n))||o.enumerable});return e};var b=(e,r,t)=>(t=e!=null?S(R(e)):{},v(r||!e||!e.__esModule?m(t,\"default\",{value:e,enumerable:!0}):t,e)),Y=e=>v(m({},\"__esModule\",{value:!0}),e);var ne={};y(ne,{default:()=>re});function P(e,r){if(r(e))return[e];let t=[];if(e.children)for(let o of e.children)t=[...t,...P(o,r)];return t}function g(e,r){return P(e,t=>t.type===r)[0]}function h(e,r){P(e,r)}function A(e,r){let t=[];if(e.filter.length===0)t=r.slice();else{e:for(let o of r){let n=o;for(let{op:i,prop:a,value:c}of e.filter)switch(i){case\"=\":{let l=n[a];if(Array.isArray(l)&&!Array.isArray(c)){if(!l.includes(c))continue e}else if(Array.isArray(l)&&Array.isArray(c)){if(!l.some(d=>c.includes(d)))continue e}else if(l!=c)continue e;break}case\"!=\":if(n[a]==c)continue e;break;case\"<\":if(!(n[a]<c))continue e;break;case\"<=\":if(!(n[a]<=c))continue e;break;case\">\":if(!(n[a]>c))continue e;break;case\">=\":if(!(n[a]>=c))continue e;break;case\"=~\":if(!new RegExp(c).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(c).exec(n[a]))continue e;break;case\"in\":if(!c.includes(n[a]))continue e;break}t.push(n)}}return e.orderBy&&(t=t.sort((o,n)=>{let i=e.orderBy,a=e.orderDesc;return o[i]===n[i]?0:o[i]<n[i]?a?1:-1:a?-1:1})),e.limit&&(t=t.slice(0,e.limit)),e.select&&(t=t.map(o=>{let n={};for(let i of e.select)n[i]=o[i];return n})),t}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;var f={};y(f,{parseMarkdown:()=>j});function j(e){return s(\"markdown.parseMarkdown\",e)}var p={};y(p,{deleteAttachment:()=>K,deletePage:()=>H,getAttachmentMeta:()=>z,getPageMeta:()=>Q,listAttachments:()=>W,listPages:()=>B,listPlugs:()=>J,readAttachment:()=>X,readPage:()=>_,writeAttachment:()=>Z,writePage:()=>V});function B(e=!1){return s(\"space.listPages\",e)}function Q(e){return s(\"space.getPageMeta\",e)}function _(e){return s(\"space.readPage\",e)}function V(e,r){return s(\"space.writePage\",e,r)}function H(e){return s(\"space.deletePage\",e)}function J(){return s(\"space.listPlugs\")}function W(){return s(\"space.listAttachments\")}function z(e){return s(\"space.getAttachmentMeta\",e)}function X(e){return s(\"space.readAttachment\",e)}function Z(e,r,t){return s(\"space.writeAttachment\",e,r,t)}function K(e){return s(\"space.deleteAttachment\",e)}var x=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function M(e,r=[\"yaml\"]){let t=await p.readPage(e),o=await f.parseMarkdown(t),n={};return h(o,i=>{if(i.type!==\"FencedCode\")return!1;let a=g(i,\"CodeInfo\");if(!a||!r.includes(a.children[0].text))return!1;let c=g(i,\"CodeText\");if(!c)return!1;let l=c.children[0].text;try{n=x.parse(l)}catch(d){throw console.error(\"YAML Page parser error\",d),new Error(`YAML Error: ${d.message}`)}return!0}),n}async function N(e){try{let r=await M(\"SECRETS\",[\"yaml\",\"secrets\"]),t=[];for(let o of e){let n=r[o];if(n)t.push(n);else throw new Error(`No such secret: ${o}`)}return t}catch(r){throw r.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):r}}async function te(){try{let[e]=await N([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var u=class{constructor(r){this.token=r}async apiCall(r,t={}){let o=await fetch(r,{...t,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(o.status<200||o.status>=300)throw new Error(await o.text());return o.json()}listEvents(r){return this.apiCall(`https://api.github.com/users/${r}/events?per_page=100`)}listPulls(r,t=\"all\",o=\"updated\"){return this.apiCall(`https://api.github.com/repos/${r}/pulls?state=${t}&sort=${o}&direction=desc&per_page=100`)}searchIssues(r,t=\"\"){return r=encodeURIComponent(r),this.apiCall(`https://api.github.com/search/issues?q=${r}&sort=${t}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(r,t,o){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:r,public:t,files:o})})).id}updateGist(r,t,o,n){return this.apiCall(`https://api.github.com/gists/${r}`,{method:\"PATCH\",body:JSON.stringify({description:t,public:o,files:n})})}async getGist(r){return(await this.apiCall(`https://api.github.com/gists/${r}`)).files}static async fromConfig(){return new u(await te())}};var E=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function $({query:e}){let r=await u.fromConfig(),t=e.filter.find(i=>i.prop===\"username\");if(!t)throw Error(\"No 'username' filter specified, this is mandatory\");let o=[];if(t.op===\"=\")o=[t.value];else if(t.op===\"in\")o=t.value;else throw new Error(`Unsupported operator ${t.op}`);let n=[];for(let i of await Promise.all(o.map(a=>r.listEvents(a))))n.push(...i);return e.filter.splice(e.filter.indexOf(t),1),A(e,n.map(i=>O(i)))}function O(e,r=\"\"){let t={};for(let[o,n]of Object.entries(e))r&&(o=r+\"_\"+o),n&&typeof n==\"object\"?t={...t,...O(n,o)}:t[o]=n;return t}var re=$;return Y(ne);})();\n return mod;})()"
    },
    "queryPulls": {
      "events": [
        "query:gh-pull"
      ],
      "code": "(() => { var mod=(()=>{var S=Object.create;var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var w=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,t)=>(typeof require!=\"undefined\"?require:r)[t]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var P=(e,r)=>{for(var t in r)m(e,t,{get:r[t],enumerable:!0})},v=(e,r,t,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let n of L(r))!I.call(e,n)&&n!==t&&m(e,n,{get:()=>r[n],enumerable:!(o=F(r,n))||o.enumerable});return e};var b=(e,r,t)=>(t=e!=null?S(R(e)):{},v(r||!e||!e.__esModule?m(t,\"default\",{value:e,enumerable:!0}):t,e)),Y=e=>v(m({},\"__esModule\",{value:!0}),e);var ne={};P(ne,{default:()=>re});function y(e,r){if(r(e))return[e];let t=[];if(e.children)for(let o of e.children)t=[...t,...y(o,r)];return t}function g(e,r){return y(e,t=>t.type===r)[0]}function h(e,r){y(e,r)}function A(e,r){let t=[];if(e.filter.length===0)t=r.slice();else{e:for(let o of r){let n=o;for(let{op:i,prop:a,value:c}of e.filter)switch(i){case\"=\":{let l=n[a];if(Array.isArray(l)&&!Array.isArray(c)){if(!l.includes(c))continue e}else if(Array.isArray(l)&&Array.isArray(c)){if(!l.some(d=>c.includes(d)))continue e}else if(l!=c)continue e;break}case\"!=\":if(n[a]==c)continue e;break;case\"<\":if(!(n[a]<c))continue e;break;case\"<=\":if(!(n[a]<=c))continue e;break;case\">\":if(!(n[a]>c))continue e;break;case\">=\":if(!(n[a]>=c))continue e;break;case\"=~\":if(!new RegExp(c).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(c).exec(n[a]))continue e;break;case\"in\":if(!c.includes(n[a]))continue e;break}t.push(n)}}return e.orderBy&&(t=t.sort((o,n)=>{let i=e.orderBy,a=e.orderDesc;return o[i]===n[i]?0:o[i]<n[i]?a?1:-1:a?-1:1})),e.limit&&(t=t.slice(0,e.limit)),e.select&&(t=t.map(o=>{let n={};for(let i of e.select)n[i]=o[i];return n})),t}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;var f={};P(f,{parseMarkdown:()=>j});function j(e){return s(\"markdown.parseMarkdown\",e)}var p={};P(p,{deleteAttachment:()=>K,deletePage:()=>H,getAttachmentMeta:()=>z,getPageMeta:()=>Q,listAttachments:()=>W,listPages:()=>B,listPlugs:()=>J,readAttachment:()=>X,readPage:()=>_,writeAttachment:()=>Z,writePage:()=>V});function B(e=!1){return s(\"space.listPages\",e)}function Q(e){return s(\"space.getPageMeta\",e)}function _(e){return s(\"space.readPage\",e)}function V(e,r){return s(\"space.writePage\",e,r)}function H(e){return s(\"space.deletePage\",e)}function J(){return s(\"space.listPlugs\")}function W(){return s(\"space.listAttachments\")}function z(e){return s(\"space.getAttachmentMeta\",e)}function X(e){return s(\"space.readAttachment\",e)}function Z(e,r,t){return s(\"space.writeAttachment\",e,r,t)}function K(e){return s(\"space.deleteAttachment\",e)}var x=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function M(e,r=[\"yaml\"]){let t=await p.readPage(e),o=await f.parseMarkdown(t),n={};return h(o,i=>{if(i.type!==\"FencedCode\")return!1;let a=g(i,\"CodeInfo\");if(!a||!r.includes(a.children[0].text))return!1;let c=g(i,\"CodeText\");if(!c)return!1;let l=c.children[0].text;try{n=x.parse(l)}catch(d){throw console.error(\"YAML Page parser error\",d),new Error(`YAML Error: ${d.message}`)}return!0}),n}async function N(e){try{let r=await M(\"SECRETS\",[\"yaml\",\"secrets\"]),t=[];for(let o of e){let n=r[o];if(n)t.push(n);else throw new Error(`No such secret: ${o}`)}return t}catch(r){throw r.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):r}}async function te(){try{let[e]=await N([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var u=class{constructor(r){this.token=r}async apiCall(r,t={}){let o=await fetch(r,{...t,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(o.status<200||o.status>=300)throw new Error(await o.text());return o.json()}listEvents(r){return this.apiCall(`https://api.github.com/users/${r}/events?per_page=100`)}listPulls(r,t=\"all\",o=\"updated\"){return this.apiCall(`https://api.github.com/repos/${r}/pulls?state=${t}&sort=${o}&direction=desc&per_page=100`)}searchIssues(r,t=\"\"){return r=encodeURIComponent(r),this.apiCall(`https://api.github.com/search/issues?q=${r}&sort=${t}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(r,t,o){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:r,public:t,files:o})})).id}updateGist(r,t,o,n){return this.apiCall(`https://api.github.com/gists/${r}`,{method:\"PATCH\",body:JSON.stringify({description:t,public:o,files:n})})}async getGist(r){return(await this.apiCall(`https://api.github.com/gists/${r}`)).files}static async fromConfig(){return new u(await te())}};var E=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function $({query:e}){let r=await u.fromConfig(),t=e.filter.find(i=>i.prop===\"repo\");if(!t)throw Error(\"No 'repo' specified, this is mandatory\");e.filter.splice(e.filter.indexOf(t),1);let o=[];if(t.op===\"=\")o=[t.value];else if(t.op===\"in\")o=t.value;else throw new Error(`Unsupported operator ${t.op}`);let n=[];for(let i of await Promise.all(o.map(a=>r.listPulls(a,\"all\",\"updated\"))))n.push(...i);return n=A(e,n.map(i=>O(i))),n}function O(e,r=\"\"){let t={};for(let[o,n]of Object.entries(e))r&&(o=r+\"_\"+o),n&&typeof n==\"object\"?t={...t,...O(n,o)}:t[o]=n;return t}var re=$;return Y(ne);})();\n return mod;})()"
    },
    "queryNotifications": {
      "events": [
        "query:gh-notification"
      ],
      "code": "(() => { var mod=(()=>{var S=Object.create;var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var w=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var y=(e,t)=>{for(var r in t)m(e,r,{get:t[r],enumerable:!0})},v=(e,t,r,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of L(t))!I.call(e,n)&&n!==r&&m(e,n,{get:()=>t[n],enumerable:!(o=F(t,n))||o.enumerable});return e};var b=(e,t,r)=>(r=e!=null?S(R(e)):{},v(t||!e||!e.__esModule?m(r,\"default\",{value:e,enumerable:!0}):r,e)),Y=e=>v(m({},\"__esModule\",{value:!0}),e);var ne={};y(ne,{default:()=>re});function P(e,t){if(t(e))return[e];let r=[];if(e.children)for(let o of e.children)r=[...r,...P(o,t)];return r}function g(e,t){return P(e,r=>r.type===t)[0]}function h(e,t){P(e,t)}function A(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let o of t){let n=o;for(let{op:c,prop:a,value:s}of e.filter)switch(c){case\"=\":{let l=n[a];if(Array.isArray(l)&&!Array.isArray(s)){if(!l.includes(s))continue e}else if(Array.isArray(l)&&Array.isArray(s)){if(!l.some(d=>s.includes(d)))continue e}else if(l!=s)continue e;break}case\"!=\":if(n[a]==s)continue e;break;case\"<\":if(!(n[a]<s))continue e;break;case\"<=\":if(!(n[a]<=s))continue e;break;case\">\":if(!(n[a]>s))continue e;break;case\">=\":if(!(n[a]>=s))continue e;break;case\"=~\":if(!new RegExp(s).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(s).exec(n[a]))continue e;break;case\"in\":if(!s.includes(n[a]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((o,n)=>{let c=e.orderBy,a=e.orderDesc;return o[c]===n[c]?0:o[c]<n[c]?a?1:-1:a?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(o=>{let n={};for(let c of e.select)n[c]=o[c];return n})),r}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var i=self.syscall;var f={};y(f,{parseMarkdown:()=>j});function j(e){return i(\"markdown.parseMarkdown\",e)}var p={};y(p,{deleteAttachment:()=>K,deletePage:()=>H,getAttachmentMeta:()=>z,getPageMeta:()=>Q,listAttachments:()=>W,listPages:()=>B,listPlugs:()=>J,readAttachment:()=>X,readPage:()=>_,writeAttachment:()=>Z,writePage:()=>V});function B(e=!1){return i(\"space.listPages\",e)}function Q(e){return i(\"space.getPageMeta\",e)}function _(e){return i(\"space.readPage\",e)}function V(e,t){return i(\"space.writePage\",e,t)}function H(e){return i(\"space.deletePage\",e)}function J(){return i(\"space.listPlugs\")}function W(){return i(\"space.listAttachments\")}function z(e){return i(\"space.getAttachmentMeta\",e)}function X(e){return i(\"space.readAttachment\",e)}function Z(e,t,r){return i(\"space.writeAttachment\",e,t,r)}function K(e){return i(\"space.deleteAttachment\",e)}var x=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function N(e,t=[\"yaml\"]){let r=await p.readPage(e),o=await f.parseMarkdown(r),n={};return h(o,c=>{if(c.type!==\"FencedCode\")return!1;let a=g(c,\"CodeInfo\");if(!a||!t.includes(a.children[0].text))return!1;let s=g(c,\"CodeText\");if(!s)return!1;let l=s.children[0].text;try{n=x.parse(l)}catch(d){throw console.error(\"YAML Page parser error\",d),new Error(`YAML Error: ${d.message}`)}return!0}),n}async function M(e){try{let t=await N(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let o of e){let n=t[o];if(n)r.push(n);else throw new Error(`No such secret: ${o}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function te(){try{let[e]=await M([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var u=class{constructor(t){this.token=t}async apiCall(t,r={}){let o=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(o.status<200||o.status>=300)throw new Error(await o.text());return o.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",o=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${o}&direction=desc&per_page=100`)}searchIssues(t,r=\"\"){return t=encodeURIComponent(t),this.apiCall(`https://api.github.com/search/issues?q=${t}&sort=${r}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(t,r,o){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:t,public:r,files:o})})).id}updateGist(t,r,o,n){return this.apiCall(`https://api.github.com/gists/${t}`,{method:\"PATCH\",body:JSON.stringify({description:r,public:o,files:n})})}async getGist(t){return(await this.apiCall(`https://api.github.com/gists/${t}`)).files}static async fromConfig(){return new u(await te())}};var E=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function $({query:e}){let r=await(await u.fromConfig()).listNotifications();return r=A(e,r.map(o=>O(o))),r}function O(e,t=\"\"){let r={};for(let[o,n]of Object.entries(e))t&&(o=t+\"_\"+o),n&&typeof n==\"object\"?r={...r,...O(n,o)}:r[o]=n;return r}var re=$;return Y(ne);})();\n return mod;})()"
    },
    "querySearchIssues": {
      "events": [
        "query:gh-search-issue"
      ],
      "code": "(() => { var mod=(()=>{var S=Object.create;var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var w=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var h=(e,t)=>{for(var r in t)m(e,r,{get:t[r],enumerable:!0})},v=(e,t,r,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of L(t))!I.call(e,n)&&n!==r&&m(e,n,{get:()=>t[n],enumerable:!(o=F(t,n))||o.enumerable});return e};var b=(e,t,r)=>(r=e!=null?S(R(e)):{},v(t||!e||!e.__esModule?m(r,\"default\",{value:e,enumerable:!0}):r,e)),Y=e=>v(m({},\"__esModule\",{value:!0}),e);var ne={};h(ne,{default:()=>re});function y(e,t){if(t(e))return[e];let r=[];if(e.children)for(let o of e.children)r=[...r,...y(o,t)];return r}function g(e,t){return y(e,r=>r.type===t)[0]}function P(e,t){y(e,t)}function A(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let o of t){let n=o;for(let{op:c,prop:i,value:a}of e.filter)switch(c){case\"=\":{let l=n[i];if(Array.isArray(l)&&!Array.isArray(a)){if(!l.includes(a))continue e}else if(Array.isArray(l)&&Array.isArray(a)){if(!l.some(d=>a.includes(d)))continue e}else if(l!=a)continue e;break}case\"!=\":if(n[i]==a)continue e;break;case\"<\":if(!(n[i]<a))continue e;break;case\"<=\":if(!(n[i]<=a))continue e;break;case\">\":if(!(n[i]>a))continue e;break;case\">=\":if(!(n[i]>=a))continue e;break;case\"=~\":if(!new RegExp(a).exec(n[i]))continue e;break;case\"!=~\":if(new RegExp(a).exec(n[i]))continue e;break;case\"in\":if(!a.includes(n[i]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((o,n)=>{let c=e.orderBy,i=e.orderDesc;return o[c]===n[c]?0:o[c]<n[c]?i?1:-1:i?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(o=>{let n={};for(let c of e.select)n[c]=o[c];return n})),r}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;var f={};h(f,{parseMarkdown:()=>j});function j(e){return s(\"markdown.parseMarkdown\",e)}var p={};h(p,{deleteAttachment:()=>K,deletePage:()=>H,getAttachmentMeta:()=>z,getPageMeta:()=>Q,listAttachments:()=>W,listPages:()=>B,listPlugs:()=>J,readAttachment:()=>X,readPage:()=>_,writeAttachment:()=>Z,writePage:()=>V});function B(e=!1){return s(\"space.listPages\",e)}function Q(e){return s(\"space.getPageMeta\",e)}function _(e){return s(\"space.readPage\",e)}function V(e,t){return s(\"space.writePage\",e,t)}function H(e){return s(\"space.deletePage\",e)}function J(){return s(\"space.listPlugs\")}function W(){return s(\"space.listAttachments\")}function z(e){return s(\"space.getAttachmentMeta\",e)}function X(e){return s(\"space.readAttachment\",e)}function Z(e,t,r){return s(\"space.writeAttachment\",e,t,r)}function K(e){return s(\"space.deleteAttachment\",e)}var x=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function M(e,t=[\"yaml\"]){let r=await p.readPage(e),o=await f.parseMarkdown(r),n={};return P(o,c=>{if(c.type!==\"FencedCode\")return!1;let i=g(c,\"CodeInfo\");if(!i||!t.includes(i.children[0].text))return!1;let a=g(c,\"CodeText\");if(!a)return!1;let l=a.children[0].text;try{n=x.parse(l)}catch(d){throw console.error(\"YAML Page parser error\",d),new Error(`YAML Error: ${d.message}`)}return!0}),n}async function N(e){try{let t=await M(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let o of e){let n=t[o];if(n)r.push(n);else throw new Error(`No such secret: ${o}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function te(){try{let[e]=await N([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var u=class{constructor(t){this.token=t}async apiCall(t,r={}){let o=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(o.status<200||o.status>=300)throw new Error(await o.text());return o.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",o=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${o}&direction=desc&per_page=100`)}searchIssues(t,r=\"\"){return t=encodeURIComponent(t),this.apiCall(`https://api.github.com/search/issues?q=${t}&sort=${r}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(t,r,o){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:t,public:r,files:o})})).id}updateGist(t,r,o,n){return this.apiCall(`https://api.github.com/gists/${t}`,{method:\"PATCH\",body:JSON.stringify({description:r,public:o,files:n})})}async getGist(t){return(await this.apiCall(`https://api.github.com/gists/${t}`)).files}static async fromConfig(){return new u(await te())}};var E=b(w(\"https://deno.land/std/encoding/yaml.ts\"));async function $({query:e}){let t=await u.fromConfig(),r=e.filter.find(i=>i.prop===\"query\");if(!r)throw Error(\"No 'query' specified, this is mandatory\");e.filter=e.filter.filter(i=>i.prop!==\"query\");let o=\"\";if(r.op===\"=\")o=r.value;else throw new Error(`Unsupported operator ${r.op}`);let n=await t.searchIssues(o);return A(e,n.items.map(i=>O(i)))}function O(e,t=\"\"){let r={};for(let[o,n]of Object.entries(e))t&&(o=t+\"_\"+o),n&&typeof n==\"object\"?r={...r,...O(n,o)}:r[o]=n;return r}var re=$;return Y(ne);})();\n return mod;})()"
    },
    "shareGistCommand": {
      "command": {
        "name": "Share: Gist: Public Gist"
      },
      "code": "(() => { var mod=(()=>{var I=Object.create;var x=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var E=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var w=(e,t)=>{for(var r in t)x(e,r,{get:t[r],enumerable:!0})},$=(e,t,r,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of G(t))!U.call(e,i)&&i!==r&&x(e,i,{get:()=>t[i],enumerable:!(o=Y(t,i))||o.enumerable});return e};var O=(e,t,r)=>(r=e!=null?I(D(e)):{},$(t||!e||!e.__esModule?x(r,\"default\",{value:e,enumerable:!0}):r,e)),j=e=>$(x({},\"__esModule\",{value:!0}),e);var be={};w(be,{default:()=>ve});function T(e){if(!!e.children)for(let t of e.children){if(t.parent)return;t.parent=e,T(t)}}function C(e,t){if(t(e))return[e];let r=[];if(e.children)for(let o of e.children)r=[...r,...C(o,t)];return r}function v(e,t){if(e.children){let r=e.children.slice();for(let o of r){let i=t(o);if(i!==void 0){let s=e.children.indexOf(o);i?e.children.splice(s,1,i):e.children.splice(s,1)}else v(o,t)}}}function b(e,t){return C(e,r=>r.type===t)[0]}function A(e,t){C(e,t)}function f(e){let t=[];if(e.text!==void 0)return e.text;for(let r of e.children)t.push(f(r));return t.join(\"\")}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var n=self.syscall;var a={};w(a,{confirm:()=>le,dispatch:()=>ae,enableReadOnlyMode:()=>ue,filterBox:()=>ee,flashNotification:()=>K,getCurrentPage:()=>B,getCursor:()=>V,getSelection:()=>H,getText:()=>_,getUiOption:()=>fe,hidePanel:()=>re,insertAtCursor:()=>se,insertAtPos:()=>ne,moveCursor:()=>ie,navigate:()=>z,openUrl:()=>Z,prompt:()=>ce,reloadPage:()=>X,replaceRange:()=>oe,save:()=>W,setPage:()=>Q,setSelection:()=>J,setUiOption:()=>pe,showPanel:()=>te});function B(){return n(\"editor.getCurrentPage\")}function Q(e){return n(\"editor.setPage\",e)}function _(){return n(\"editor.getText\")}function V(){return n(\"editor.getCursor\")}function H(){return n(\"editor.getSelection\")}function J(e,t){return n(\"editor.setSelection\",e,t)}function W(){return n(\"editor.save\")}function z(e,t,r=!1,o=!1){return n(\"editor.navigate\",e,t,r,o)}function X(){return n(\"editor.reloadPage\")}function Z(e){return n(\"editor.openUrl\",e)}function K(e,t=\"info\"){return n(\"editor.flashNotification\",e,t)}function ee(e,t,r=\"\",o=\"\"){return n(\"editor.filterBox\",e,t,r,o)}function te(e,t,r,o=\"\"){return n(\"editor.showPanel\",e,t,r,o)}function re(e){return n(\"editor.hidePanel\",e)}function ne(e,t){return n(\"editor.insertAtPos\",e,t)}function oe(e,t,r){return n(\"editor.replaceRange\",e,t,r)}function ie(e,t=!1){return n(\"editor.moveCursor\",e,t)}function se(e){return n(\"editor.insertAtCursor\",e)}function ae(e){return n(\"editor.dispatch\",e)}function ce(e,t=\"\"){return n(\"editor.prompt\",e,t)}function le(e){return n(\"editor.confirm\",e)}function ue(e){return n(\"editor.enableReadOnlyMode\",e)}function fe(e){return n(\"editor.getUiOption\",e)}function pe(e,t){return n(\"editor.setUiOption\",e,t)}var d={};w(d,{parseMarkdown:()=>me});function me(e){return n(\"markdown.parseMarkdown\",e)}var m={};w(m,{invokeCommand:()=>Pe,invokeFunction:()=>he,listCommands:()=>ye,reloadPlugs:()=>xe});function he(e,t,...r){return n(\"system.invokeFunction\",e,t,...r)}function Pe(e){return n(\"system.invokeCommand\",e)}function ye(){return n(\"system.listCommands\")}function xe(){n(\"system.reloadPlugs\")}var S=O(E(\"https://deno.land/std/encoding/yaml.ts\"));var c=O(E(\"https://deno.land/std/encoding/yaml.ts\"));function F(e,t=[]){let r={};return T(e),v(e,o=>{if(o.type===\"Hashtag\"){if(o.parent&&o.parent.type===\"Paragraph\"){let u=o.children[0].text.substring(1);r.tags||(r.tags=[]),r.tags.includes(u)||r.tags.push(u)}return}if(o.type===\"FrontMatter\"){let u=o.children[1].children[0],h=f(u);try{let P=c.parse(h),y={...P};if(r={...r,...P},t.length>0){let M=!1;for(let N of t)N in y&&(delete y[N],M=!0);M&&(u.text=c.stringify(y))}if(Object.keys(y).length===0)return null}catch(P){console.error(\"Could not parse frontmatter\",P)}}if(o.type!==\"FencedCode\")return;let i=b(o,\"CodeInfo\");if(!i||i.children[0].text!==\"meta\")return;let s=b(o,\"CodeText\");if(!s)return;let p=s.children[0].text,l=c.parse(p),g={...l};if(r={...r,...l},t.length>0){let u=!1;for(let h of t)h in g&&(delete g[h],u=!0);u&&(s.children[0].text=c.stringify(g).trim())}if(Object.keys(g).length===0)return null}),r.name&&(r.displayName=r.name,delete r.name),r}function L(e,t){let r=null;return A(e,o=>{if(o.type===\"FrontMatter\"){let i=o.children[1].children[0],s=f(i);try{let l={...c.parse(s),...t};r={changes:{from:i.from,to:i.to,insert:c.stringify(l,{noArrayIndent:!0})}}}catch(p){console.error(\"Error parsing YAML\",p)}return!0}return!1}),r||(r={changes:{from:0,to:0,insert:`---\n`+c.stringify(t,{noArrayIndent:!0})+`---\n`}}),r}async function R(){let e=await a.getCurrentPage(),t=await a.getText(),r=await d.parseMarkdown(t),{$share:o}=F(r,[\"$share\"]),i=f(r);o||(o=[]);for(let l of o)if(l.startsWith(\"gh-gist:\")){await m.invokeFunction(\"server\",\"updateGist\",{name:e,uri:l}),await a.flashNotification(\"Updated!\"),await a.openUrl(`https://gist.github.com/${l.split(\":\")[1]}`);return}let s=await m.invokeFunction(\"server\",\"createGist\",e,i),p=L(r,{$share:[...o,`gh-gist:${s}`]});await a.flashNotification(\"Done!\"),await a.dispatch(p),await a.openUrl(`https://gist.github.com/${s}`)}var ve=R;return j(be);})();\n return mod;})()"
    },
    "loadGistCommand": {
      "command": {
        "name": "Share: Gist: Load"
      },
      "code": "(() => { var mod=(()=>{var v=Object.create;var c=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var d=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,n)=>(typeof require!=\"undefined\"?require:r)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var l=(e,r)=>{for(var n in r)c(e,n,{get:r[n],enumerable:!0})},m=(e,r,n,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let i of T(r))!A.call(e,i)&&i!==n&&c(e,i,{get:()=>r[i],enumerable:!(o=b(r,i))||o.enumerable});return e};var g=(e,r,n)=>(n=e!=null?v(C(e)):{},m(r||!e||!e.__esModule?c(n,\"default\",{value:e,enumerable:!0}):n,e)),k=e=>m(c({},\"__esModule\",{value:!0}),e);var we={};l(we,{default:()=>xe});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;var s={};l(s,{confirm:()=>W,dispatch:()=>H,enableReadOnlyMode:()=>z,filterBox:()=>U,flashNotification:()=>D,getCurrentPage:()=>E,getCursor:()=>S,getSelection:()=>F,getText:()=>O,getUiOption:()=>X,hidePanel:()=>q,insertAtCursor:()=>V,insertAtPos:()=>B,moveCursor:()=>_,navigate:()=>I,openUrl:()=>G,prompt:()=>J,reloadPage:()=>Y,replaceRange:()=>Q,save:()=>R,setPage:()=>$,setSelection:()=>L,setUiOption:()=>Z,showPanel:()=>j});function E(){return t(\"editor.getCurrentPage\")}function $(e){return t(\"editor.setPage\",e)}function O(){return t(\"editor.getText\")}function S(){return t(\"editor.getCursor\")}function F(){return t(\"editor.getSelection\")}function L(e,r){return t(\"editor.setSelection\",e,r)}function R(){return t(\"editor.save\")}function I(e,r,n=!1,o=!1){return t(\"editor.navigate\",e,r,n,o)}function Y(){return t(\"editor.reloadPage\")}function G(e){return t(\"editor.openUrl\",e)}function D(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function U(e,r,n=\"\",o=\"\"){return t(\"editor.filterBox\",e,r,n,o)}function j(e,r,n,o=\"\"){return t(\"editor.showPanel\",e,r,n,o)}function q(e){return t(\"editor.hidePanel\",e)}function B(e,r){return t(\"editor.insertAtPos\",e,r)}function Q(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function _(e,r=!1){return t(\"editor.moveCursor\",e,r)}function V(e){return t(\"editor.insertAtCursor\",e)}function H(e){return t(\"editor.dispatch\",e)}function J(e,r=\"\"){return t(\"editor.prompt\",e,r)}function W(e){return t(\"editor.confirm\",e)}function z(e){return t(\"editor.enableReadOnlyMode\",e)}function X(e){return t(\"editor.getUiOption\",e)}function Z(e,r){return t(\"editor.setUiOption\",e,r)}var a={};l(a,{deleteAttachment:()=>fe,deletePage:()=>ie,getAttachmentMeta:()=>ce,getPageMeta:()=>re,listAttachments:()=>ae,listPages:()=>te,listPlugs:()=>se,readAttachment:()=>le,readPage:()=>ne,writeAttachment:()=>ue,writePage:()=>oe});function te(e=!1){return t(\"space.listPages\",e)}function re(e){return t(\"space.getPageMeta\",e)}function ne(e){return t(\"space.readPage\",e)}function oe(e,r){return t(\"space.writePage\",e,r)}function ie(e){return t(\"space.deletePage\",e)}function se(){return t(\"space.listPlugs\")}function ae(){return t(\"space.listAttachments\")}function ce(e){return t(\"space.getAttachmentMeta\",e)}function le(e){return t(\"space.readAttachment\",e)}function ue(e,r,n){return t(\"space.writeAttachment\",e,r,n)}function fe(e){return t(\"space.deleteAttachment\",e)}var u={};l(u,{invokeCommand:()=>de,invokeFunction:()=>pe,listCommands:()=>me,reloadPlugs:()=>ge});function pe(e,r,...n){return t(\"system.invokeFunction\",e,r,...n)}function de(e){return t(\"system.invokeCommand\",e)}function me(){return t(\"system.listCommands\")}function ge(){t(\"system.reloadPlugs\")}var h=g(d(\"https://deno.land/std/encoding/yaml.ts\"));var y=g(d(\"https://deno.land/std/encoding/yaml.ts\"));async function x(){let e=await s.prompt(\"Gist URL:\");if(!e)return;let r=e.split(\"/\"),n=r[r.length-1],o=await u.invokeFunction(\"server\",\"getGist\",n);if(Object.keys(o).length!==1){await s.flashNotification(\"Only gists with a single file are supported\",\"error\");return}let i=Object.keys(o)[0].replace(/\\.md$/,\"\"),w=Object.values(o)[0].content,f=await s.prompt(\"Page name:\",i);!f||(await a.writePage(f,`---\n$share:\n- 'gh-gist:${n}'\n---\n${w}`),await s.navigate(f))}var xe=x;return k(we);})();\n return mod;})()"
    },
    "openGistCommand": {
      "command": {
        "name": "Share: Gist: Open In Browser"
      },
      "code": "(() => { var mod=(()=>{var L=Object.create;var P=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var A=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var x=(e,t)=>{for(var r in t)P(e,r,{get:t[r],enumerable:!0})},k=(e,t,r,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of I(t))!G.call(e,i)&&i!==r&&P(e,i,{get:()=>t[i],enumerable:!(o=R(t,i))||o.enumerable});return e};var M=(e,t,r)=>(r=e!=null?L(Y(e)):{},k(t||!e||!e.__esModule?P(r,\"default\",{value:e,enumerable:!0}):r,e)),D=e=>k(P({},\"__esModule\",{value:!0}),e);var he={};x(he,{default:()=>Pe});function w(e){if(!!e.children)for(let t of e.children){if(t.parent)return;t.parent=e,w(t)}}function N(e,t){if(t(e))return[e];let r=[];if(e.children)for(let o of e.children)r=[...r,...N(o,t)];return r}function h(e,t){if(e.children){let r=e.children.slice();for(let o of r){let i=t(o);if(i!==void 0){let s=e.children.indexOf(o);i?e.children.splice(s,1,i):e.children.splice(s,1)}else h(o,t)}}}function y(e,t){return N(e,r=>r.type===t)[0]}function u(e){let t=[];if(e.text!==void 0)return e.text;for(let r of e.children)t.push(u(r));return t.join(\"\")}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var n=self.syscall;var c={};x(c,{confirm:()=>ae,dispatch:()=>ie,enableReadOnlyMode:()=>ce,filterBox:()=>Z,flashNotification:()=>X,getCurrentPage:()=>j,getCursor:()=>Q,getSelection:()=>_,getText:()=>B,getUiOption:()=>le,hidePanel:()=>ee,insertAtCursor:()=>oe,insertAtPos:()=>te,moveCursor:()=>ne,navigate:()=>J,openUrl:()=>z,prompt:()=>se,reloadPage:()=>W,replaceRange:()=>re,save:()=>H,setPage:()=>q,setSelection:()=>V,setUiOption:()=>ue,showPanel:()=>K});function j(){return n(\"editor.getCurrentPage\")}function q(e){return n(\"editor.setPage\",e)}function B(){return n(\"editor.getText\")}function Q(){return n(\"editor.getCursor\")}function _(){return n(\"editor.getSelection\")}function V(e,t){return n(\"editor.setSelection\",e,t)}function H(){return n(\"editor.save\")}function J(e,t,r=!1,o=!1){return n(\"editor.navigate\",e,t,r,o)}function W(){return n(\"editor.reloadPage\")}function z(e){return n(\"editor.openUrl\",e)}function X(e,t=\"info\"){return n(\"editor.flashNotification\",e,t)}function Z(e,t,r=\"\",o=\"\"){return n(\"editor.filterBox\",e,t,r,o)}function K(e,t,r,o=\"\"){return n(\"editor.showPanel\",e,t,r,o)}function ee(e){return n(\"editor.hidePanel\",e)}function te(e,t){return n(\"editor.insertAtPos\",e,t)}function re(e,t,r){return n(\"editor.replaceRange\",e,t,r)}function ne(e,t=!1){return n(\"editor.moveCursor\",e,t)}function oe(e){return n(\"editor.insertAtCursor\",e)}function ie(e){return n(\"editor.dispatch\",e)}function se(e,t=\"\"){return n(\"editor.prompt\",e,t)}function ae(e){return n(\"editor.confirm\",e)}function ce(e){return n(\"editor.enableReadOnlyMode\",e)}function le(e){return n(\"editor.getUiOption\",e)}function ue(e,t){return n(\"editor.setUiOption\",e,t)}var f={};x(f,{parseMarkdown:()=>pe});function pe(e){return n(\"markdown.parseMarkdown\",e)}var $=M(A(\"https://deno.land/std/encoding/yaml.ts\"));var l=M(A(\"https://deno.land/std/encoding/yaml.ts\"));function O(e,t=[]){let r={};return w(e),h(e,o=>{if(o.type===\"Hashtag\"){if(o.parent&&o.parent.type===\"Paragraph\"){let a=o.children[0].text.substring(1);r.tags||(r.tags=[]),r.tags.includes(a)||r.tags.push(a)}return}if(o.type===\"FrontMatter\"){let a=o.children[1].children[0],d=u(a);try{let m=l.parse(d),g={...m};if(r={...r,...m},t.length>0){let T=!1;for(let C of t)C in g&&(delete g[C],T=!0);T&&(a.text=l.stringify(g))}if(Object.keys(g).length===0)return null}catch(m){console.error(\"Could not parse frontmatter\",m)}}if(o.type!==\"FencedCode\")return;let i=y(o,\"CodeInfo\");if(!i||i.children[0].text!==\"meta\")return;let s=y(o,\"CodeText\");if(!s)return;let F=s.children[0].text,b=l.parse(F),p={...b};if(r={...r,...b},t.length>0){let a=!1;for(let d of t)d in p&&(delete p[d],a=!0);a&&(s.children[0].text=l.stringify(p).trim())}if(Object.keys(p).length===0)return null}),r.name&&(r.displayName=r.name,delete r.name),r}async function S(){let e=await c.getText(),t=await f.parseMarkdown(e),{$share:r}=O(t);if(!r){await c.flashNotification(\"Not currently shared as gist\",\"error\");return}for(let o of r)if(o.startsWith(\"gh-gist:\")){let s=`https://gist.github.com/${o.split(\":\")[1]}`;await c.openUrl(s);return}await c.flashNotification(\"Not currently shared as gist\",\"error\")}var Pe=S;return D(he);})();\n return mod;})()"
    },
    "createGist": {
      "env": "server",
      "code": "(() => { var mod=(()=>{var $=Object.create;var l=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var x=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var p=(e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})},w=(e,t,r,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of S(t))!L.call(e,i)&&i!==r&&l(e,i,{get:()=>t[i],enumerable:!(n=O(t,i))||n.enumerable});return e};var v=(e,t,r)=>(r=e!=null?$(F(e)):{},w(t||!e||!e.__esModule?l(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>w(l({},\"__esModule\",{value:!0}),e);var te={};p(te,{default:()=>ee});function d(e,t){if(t(e))return[e];let r=[];if(e.children)for(let n of e.children)r=[...r,...d(n,t)];return r}function u(e,t){return d(e,r=>r.type===t)[0]}function m(e,t){d(e,t)}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var o=self.syscall;var a={};p(a,{parseMarkdown:()=>D});function D(e){return o(\"markdown.parseMarkdown\",e)}var c={};p(c,{deleteAttachment:()=>X,deletePage:()=>_,getAttachmentMeta:()=>J,getPageMeta:()=>q,listAttachments:()=>H,listPages:()=>j,listPlugs:()=>V,readAttachment:()=>W,readPage:()=>B,writeAttachment:()=>z,writePage:()=>Q});function j(e=!1){return o(\"space.listPages\",e)}function q(e){return o(\"space.getPageMeta\",e)}function B(e){return o(\"space.readPage\",e)}function Q(e,t){return o(\"space.writePage\",e,t)}function _(e){return o(\"space.deletePage\",e)}function V(){return o(\"space.listPlugs\")}function H(){return o(\"space.listAttachments\")}function J(e){return o(\"space.getAttachmentMeta\",e)}function W(e){return o(\"space.readAttachment\",e)}function z(e,t,r){return o(\"space.writeAttachment\",e,t,r)}function X(e){return o(\"space.deleteAttachment\",e)}var g=v(x(\"https://deno.land/std/encoding/yaml.ts\"));async function C(e,t=[\"yaml\"]){let r=await c.readPage(e),n=await a.parseMarkdown(r),i={};return m(n,f=>{if(f.type!==\"FencedCode\")return!1;let P=u(f,\"CodeInfo\");if(!P||!t.includes(P.children[0].text))return!1;let h=u(f,\"CodeText\");if(!h)return!1;let E=h.children[0].text;try{i=g.parse(E)}catch(y){throw console.error(\"YAML Page parser error\",y),new Error(`YAML Error: ${y.message}`)}return!0}),i}async function k(e){try{let t=await C(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let n of e){let i=t[n];if(i)r.push(i);else throw new Error(`No such secret: ${n}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function K(){try{let[e]=await k([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var s=class{constructor(t){this.token=t}async apiCall(t,r={}){let n=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(n.status<200||n.status>=300)throw new Error(await n.text());return n.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",n=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${n}&direction=desc&per_page=100`)}searchIssues(t,r=\"\"){return t=encodeURIComponent(t),this.apiCall(`https://api.github.com/search/issues?q=${t}&sort=${r}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(t,r,n){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:t,public:r,files:n})})).id}updateGist(t,r,n,i){return this.apiCall(`https://api.github.com/gists/${t}`,{method:\"PATCH\",body:JSON.stringify({description:r,public:n,files:i})})}async getGist(t){return(await this.apiCall(`https://api.github.com/gists/${t}`)).files}static async fromConfig(){return new s(await K())}};var M=v(x(\"https://deno.land/std/encoding/yaml.ts\"));async function N(e,t){return(await s.fromConfig()).createGist(\"\",!0,{[`${e}.md`]:{content:t}})}var ee=N;return R(te);})();\n return mod;})()"
    },
    "updateGist": {
      "env": "server",
      "events": [
        "share:gh-gist"
      ],
      "code": "(() => { var mod=(()=>{var G=Object.create;var w=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var E=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var b=(e,t)=>{for(var r in t)w(e,r,{get:t[r],enumerable:!0})},$=(e,t,r,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let o of U(t))!q.call(e,o)&&o!==r&&w(e,o,{get:()=>t[o],enumerable:!(n=D(t,o))||n.enumerable});return e};var O=(e,t,r)=>(r=e!=null?G(j(e)):{},$(t||!e||!e.__esModule?w(r,\"default\",{value:e,enumerable:!0}):r,e)),B=e=>$(w({},\"__esModule\",{value:!0}),e);var ce={};b(ce,{default:()=>ae});function T(e){if(!!e.children)for(let t of e.children){if(t.parent)return;t.parent=e,T(t)}}function A(e,t){if(t(e))return[e];let r=[];if(e.children)for(let n of e.children)r=[...r,...A(n,t)];return r}function v(e,t){if(e.children){let r=e.children.slice();for(let n of r){let o=t(n);if(o!==void 0){let s=e.children.indexOf(n);o?e.children.splice(s,1,o):e.children.splice(s,1)}else v(n,t)}}}function l(e,t){return A(e,r=>r.type===t)[0]}function C(e,t){A(e,t)}function u(e){let t=[];if(e.text!==void 0)return e.text;for(let r of e.children)t.push(u(r));return t.join(\"\")}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var i=self.syscall;var f={};b(f,{parseMarkdown:()=>V});function V(e){return i(\"markdown.parseMarkdown\",e)}var p={};b(p,{deleteAttachment:()=>oe,deletePage:()=>Z,getAttachmentMeta:()=>te,getPageMeta:()=>W,listAttachments:()=>ee,listPages:()=>J,listPlugs:()=>K,readAttachment:()=>re,readPage:()=>z,writeAttachment:()=>ne,writePage:()=>X});function J(e=!1){return i(\"space.listPages\",e)}function W(e){return i(\"space.getPageMeta\",e)}function z(e){return i(\"space.readPage\",e)}function X(e,t){return i(\"space.writePage\",e,t)}function Z(e){return i(\"space.deletePage\",e)}function K(){return i(\"space.listPlugs\")}function ee(){return i(\"space.listAttachments\")}function te(e){return i(\"space.getAttachmentMeta\",e)}function re(e){return i(\"space.readAttachment\",e)}function ne(e,t,r){return i(\"space.writeAttachment\",e,t,r)}function oe(e){return i(\"space.deleteAttachment\",e)}var k=O(E(\"https://deno.land/std/encoding/yaml.ts\"));async function L(e,t=[\"yaml\"]){let r=await p.readPage(e),n=await f.parseMarkdown(r),o={};return C(n,s=>{if(s.type!==\"FencedCode\")return!1;let P=l(s,\"CodeInfo\");if(!P||!t.includes(P.children[0].text))return!1;let g=l(s,\"CodeText\");if(!g)return!1;let c=g.children[0].text;try{o=k.parse(c)}catch(a){throw console.error(\"YAML Page parser error\",a),new Error(`YAML Error: ${a.message}`)}return!0}),o}async function R(e){try{let t=await L(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let n of e){let o=t[n];if(o)r.push(o);else throw new Error(`No such secret: ${n}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function se(){try{let[e]=await R([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var d=class{constructor(t){this.token=t}async apiCall(t,r={}){let n=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(n.status<200||n.status>=300)throw new Error(await n.text());return n.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",n=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${n}&direction=desc&per_page=100`)}searchIssues(t,r=\"\"){return t=encodeURIComponent(t),this.apiCall(`https://api.github.com/search/issues?q=${t}&sort=${r}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(t,r,n){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:t,public:r,files:n})})).id}updateGist(t,r,n,o){return this.apiCall(`https://api.github.com/gists/${t}`,{method:\"PATCH\",body:JSON.stringify({description:r,public:n,files:o})})}async getGist(t){return(await this.apiCall(`https://api.github.com/gists/${t}`)).files}static async fromConfig(){return new d(await se())}};var m=O(E(\"https://deno.land/std/encoding/yaml.ts\"));function I(e,t=[]){let r={};return T(e),v(e,n=>{if(n.type===\"Hashtag\"){if(n.parent&&n.parent.type===\"Paragraph\"){let a=n.children[0].text.substring(1);r.tags||(r.tags=[]),r.tags.includes(a)||r.tags.push(a)}return}if(n.type===\"FrontMatter\"){let a=n.children[1].children[0],h=u(a);try{let y=m.parse(h),x={...y};if(r={...r,...y},t.length>0){let M=!1;for(let N of t)N in x&&(delete x[N],M=!0);M&&(a.text=m.stringify(x))}if(Object.keys(x).length===0)return null}catch(y){console.error(\"Could not parse frontmatter\",y)}}if(n.type!==\"FencedCode\")return;let o=l(n,\"CodeInfo\");if(!o||o.children[0].text!==\"meta\")return;let s=l(n,\"CodeText\");if(!s)return;let P=s.children[0].text,g=m.parse(P),c={...g};if(r={...r,...g},t.length>0){let a=!1;for(let h of t)h in c&&(delete c[h],a=!0);a&&(s.children[0].text=m.stringify(c).trim())}if(Object.keys(c).length===0)return null}),r.name&&(r.displayName=r.name,delete r.name),r}async function Y(e){let t=e.uri.split(\":\")[1],r=await d.fromConfig(),n=await p.readPage(e.name),o=await f.parseMarkdown(n);I(o,[\"$share\"]);let s=u(o);return await r.updateGist(t,\"\",!0,{[`${e.name}.md`]:{content:s}}),!0}var ae=Y;return B(ce);})();\n return mod;})()"
    },
    "getGist": {
      "env": "server",
      "code": "(() => { var mod=(()=>{var $=Object.create;var l=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var x=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var p=(e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})},w=(e,t,r,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of S(t))!L.call(e,i)&&i!==r&&l(e,i,{get:()=>t[i],enumerable:!(n=O(t,i))||n.enumerable});return e};var v=(e,t,r)=>(r=e!=null?$(F(e)):{},w(t||!e||!e.__esModule?l(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>w(l({},\"__esModule\",{value:!0}),e);var te={};p(te,{default:()=>ee});function d(e,t){if(t(e))return[e];let r=[];if(e.children)for(let n of e.children)r=[...r,...d(n,t)];return r}function u(e,t){return d(e,r=>r.type===t)[0]}function m(e,t){d(e,t)}typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var o=self.syscall;var a={};p(a,{parseMarkdown:()=>D});function D(e){return o(\"markdown.parseMarkdown\",e)}var c={};p(c,{deleteAttachment:()=>X,deletePage:()=>_,getAttachmentMeta:()=>J,getPageMeta:()=>q,listAttachments:()=>H,listPages:()=>j,listPlugs:()=>V,readAttachment:()=>W,readPage:()=>B,writeAttachment:()=>z,writePage:()=>Q});function j(e=!1){return o(\"space.listPages\",e)}function q(e){return o(\"space.getPageMeta\",e)}function B(e){return o(\"space.readPage\",e)}function Q(e,t){return o(\"space.writePage\",e,t)}function _(e){return o(\"space.deletePage\",e)}function V(){return o(\"space.listPlugs\")}function H(){return o(\"space.listAttachments\")}function J(e){return o(\"space.getAttachmentMeta\",e)}function W(e){return o(\"space.readAttachment\",e)}function z(e,t,r){return o(\"space.writeAttachment\",e,t,r)}function X(e){return o(\"space.deleteAttachment\",e)}var g=v(x(\"https://deno.land/std/encoding/yaml.ts\"));async function C(e,t=[\"yaml\"]){let r=await c.readPage(e),n=await a.parseMarkdown(r),i={};return m(n,f=>{if(f.type!==\"FencedCode\")return!1;let P=u(f,\"CodeInfo\");if(!P||!t.includes(P.children[0].text))return!1;let h=u(f,\"CodeText\");if(!h)return!1;let E=h.children[0].text;try{i=g.parse(E)}catch(y){throw console.error(\"YAML Page parser error\",y),new Error(`YAML Error: ${y.message}`)}return!0}),i}async function k(e){try{let t=await C(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let n of e){let i=t[n];if(i)r.push(i);else throw new Error(`No such secret: ${n}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function K(){try{let[e]=await k([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var s=class{constructor(t){this.token=t}async apiCall(t,r={}){let n=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(n.status<200||n.status>=300)throw new Error(await n.text());return n.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",n=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${n}&direction=desc&per_page=100`)}searchIssues(t,r=\"\"){return t=encodeURIComponent(t),this.apiCall(`https://api.github.com/search/issues?q=${t}&sort=${r}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}async createGist(t,r,n){return(await this.apiCall(\"https://api.github.com/gists\",{method:\"POST\",body:JSON.stringify({description:t,public:r,files:n})})).id}updateGist(t,r,n,i){return this.apiCall(`https://api.github.com/gists/${t}`,{method:\"PATCH\",body:JSON.stringify({description:r,public:n,files:i})})}async getGist(t){return(await this.apiCall(`https://api.github.com/gists/${t}`)).files}static async fromConfig(){return new s(await K())}};var M=v(x(\"https://deno.land/std/encoding/yaml.ts\"));async function N(e){return(await s.fromConfig()).getGist(e)}var ee=N;return R(te);})();\n return mod;})()"
    }
  },
  "assets": {}
}