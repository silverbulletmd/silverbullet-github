{
  "name": "github",
  "imports": [
    "https://get.silverbullet.md/global.plug.json"
  ],
  "functions": {
    "queryEvents": {
      "events": [
        "query:gh-event"
      ],
      "code": "(() => { var mod=(()=>{var k=Object.create;var u=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var m=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var O=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},x=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!Y.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=N(t,n))||i.enumerable});return e};var d=(e,t,r)=>(r=e!=null?k(L(e)):{},x(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>x(u({},\"__esModule\",{value:!0}),e);var H={};O(H,{default:()=>D});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function P(e,t){return g(e,r=>r.type===t)[0]}function w(e,t){g(e,t)}var $=d(m(\"https://esm.sh/handlebars\")),S=d(m(\"https://deno.land/std/encoding/yaml.ts\"));typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;function h(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:a,prop:o,value:s}of e.filter)switch(a){case\"=\":let l=n[o];if(Array.isArray(l)&&!Array.isArray(s)){if(!l.includes(s))continue e}else if(Array.isArray(l)&&Array.isArray(s)){if(!l.some(f=>s.includes(f)))continue e}else if(l!=s)continue e;break;case\"!=\":if(n[o]==s)continue e;break;case\"<\":if(!(n[o]<s))continue e;break;case\"<=\":if(!(n[o]<=s))continue e;break;case\">\":if(!(n[o]>s))continue e;break;case\">=\":if(!(n[o]>=s))continue e;break;case\"=~\":if(!new RegExp(s).exec(n[o]))continue e;break;case\"!=~\":if(new RegExp(s).exec(n[o]))continue e;break;case\"in\":if(!s.includes(n[o]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let a=e.orderBy,o=e.orderDesc;return i[a]===n[a]?0:i[a]<n[a]?o?1:-1:o?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let a of e.select)n[a]=i[a];return n})),r}function b(e){return p(\"markdown.parseMarkdown\",e)}var y=d(m(\"https://deno.land/std/encoding/yaml.ts\"));async function A(e,t=[\"yaml\"]){let{text:r}=await h(e),i=await b(r),n={};return w(i,a=>{if(a.type!==\"FencedCode\")return!1;let o=P(a,\"CodeInfo\");if(!o||!t.includes(o.children[0].text))return!1;let s=P(a,\"CodeText\");if(!s)return!1;let l=s.children[0].text;try{n=y.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function M(e){try{let t=await A(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function j(){try{let[e]=await M([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await j())}};async function E({query:e}){let t=await c.fromConfig(),r=e.filter.find(a=>a.prop===\"username\");if(!r)throw Error(\"No 'username' filter specified, this is mandatory\");let i=[];if(r.op===\"=\")i=[r.value];else if(r.op===\"in\")i=r.value;else throw new Error(`Unsupported operator ${r.op}`);let n=[];for(let a of await Promise.all(i.map(o=>t.listEvents(o))))n.push(...a);return e.filter.splice(e.filter.indexOf(r),1),T(e,n.map(a=>v(a)))}function v(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...v(n,i)}:r[i]=n;return r}var D=E;return R(H);})();\n return mod;})()"
    },
    "queryPulls": {
      "events": [
        "query:gh-pull"
      ],
      "code": "(() => { var mod=(()=>{var k=Object.create;var u=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var m=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var O=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},x=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!Y.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=N(t,n))||i.enumerable});return e};var d=(e,t,r)=>(r=e!=null?k(L(e)):{},x(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>x(u({},\"__esModule\",{value:!0}),e);var H={};O(H,{default:()=>D});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function P(e,t){return g(e,r=>r.type===t)[0]}function w(e,t){g(e,t)}var $=d(m(\"https://esm.sh/handlebars\")),S=d(m(\"https://deno.land/std/encoding/yaml.ts\"));typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;function h(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:a,prop:o,value:s}of e.filter)switch(a){case\"=\":let l=n[o];if(Array.isArray(l)&&!Array.isArray(s)){if(!l.includes(s))continue e}else if(Array.isArray(l)&&Array.isArray(s)){if(!l.some(f=>s.includes(f)))continue e}else if(l!=s)continue e;break;case\"!=\":if(n[o]==s)continue e;break;case\"<\":if(!(n[o]<s))continue e;break;case\"<=\":if(!(n[o]<=s))continue e;break;case\">\":if(!(n[o]>s))continue e;break;case\">=\":if(!(n[o]>=s))continue e;break;case\"=~\":if(!new RegExp(s).exec(n[o]))continue e;break;case\"!=~\":if(new RegExp(s).exec(n[o]))continue e;break;case\"in\":if(!s.includes(n[o]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let a=e.orderBy,o=e.orderDesc;return i[a]===n[a]?0:i[a]<n[a]?o?1:-1:o?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let a of e.select)n[a]=i[a];return n})),r}function b(e){return p(\"markdown.parseMarkdown\",e)}var y=d(m(\"https://deno.land/std/encoding/yaml.ts\"));async function A(e,t=[\"yaml\"]){let{text:r}=await h(e),i=await b(r),n={};return w(i,a=>{if(a.type!==\"FencedCode\")return!1;let o=P(a,\"CodeInfo\");if(!o||!t.includes(o.children[0].text))return!1;let s=P(a,\"CodeText\");if(!s)return!1;let l=s.children[0].text;try{n=y.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function M(e){try{let t=await A(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function j(){try{let[e]=await M([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await j())}};async function E({query:e}){let t=await c.fromConfig(),r=e.filter.find(a=>a.prop===\"repo\");if(!r)throw Error(\"No 'repo' specified, this is mandatory\");e.filter.splice(e.filter.indexOf(r),1);let i=[];if(r.op===\"=\")i=[r.value];else if(r.op===\"in\")i=r.value;else throw new Error(`Unsupported operator ${r.op}`);let n=[];for(let a of await Promise.all(i.map(o=>t.listPulls(o,\"all\",\"updated\"))))n.push(...a);return n=T(e,n.map(a=>v(a))),n}function v(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...v(n,i)}:r[i]=n;return r}var D=E;return R(H);})();\n return mod;})()"
    },
    "queryNotifications": {
      "events": [
        "query:gh-notification"
      ],
      "code": "(() => { var mod=(()=>{var k=Object.create;var u=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var m=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var O=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},x=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!Y.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=N(t,n))||i.enumerable});return e};var d=(e,t,r)=>(r=e!=null?k(L(e)):{},x(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>x(u({},\"__esModule\",{value:!0}),e);var H={};O(H,{default:()=>D});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function P(e,t){return g(e,r=>r.type===t)[0]}function w(e,t){g(e,t)}var $=d(m(\"https://esm.sh/handlebars\")),S=d(m(\"https://deno.land/std/encoding/yaml.ts\"));typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;function h(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:s,prop:o,value:a}of e.filter)switch(s){case\"=\":let l=n[o];if(Array.isArray(l)&&!Array.isArray(a)){if(!l.includes(a))continue e}else if(Array.isArray(l)&&Array.isArray(a)){if(!l.some(f=>a.includes(f)))continue e}else if(l!=a)continue e;break;case\"!=\":if(n[o]==a)continue e;break;case\"<\":if(!(n[o]<a))continue e;break;case\"<=\":if(!(n[o]<=a))continue e;break;case\">\":if(!(n[o]>a))continue e;break;case\">=\":if(!(n[o]>=a))continue e;break;case\"=~\":if(!new RegExp(a).exec(n[o]))continue e;break;case\"!=~\":if(new RegExp(a).exec(n[o]))continue e;break;case\"in\":if(!a.includes(n[o]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let s=e.orderBy,o=e.orderDesc;return i[s]===n[s]?0:i[s]<n[s]?o?1:-1:o?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let s of e.select)n[s]=i[s];return n})),r}function b(e){return p(\"markdown.parseMarkdown\",e)}var y=d(m(\"https://deno.land/std/encoding/yaml.ts\"));async function A(e,t=[\"yaml\"]){let{text:r}=await h(e),i=await b(r),n={};return w(i,s=>{if(s.type!==\"FencedCode\")return!1;let o=P(s,\"CodeInfo\");if(!o||!t.includes(o.children[0].text))return!1;let a=P(s,\"CodeText\");if(!a)return!1;let l=a.children[0].text;try{n=y.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function M(e){try{let t=await A(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function j(){try{let[e]=await M([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await j())}};async function E({query:e}){let r=await(await c.fromConfig()).listNotifications();return r=T(e,r.map(i=>v(i))),r}function v(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...v(n,i)}:r[i]=n;return r}var D=E;return R(H);})();\n return mod;})()"
    }
  },
  "assets": {}
}